[build]
builder = "NIXPACKS"

[deploy]
numReplicas = 1
restartPolicyType = "ON_FAILURE"
restartPolicyMaxRetries = 3

[[services]]
name = "backend"
buildCommand = "cd backend && npm install && npm run build"
startCommand = "cd backend && npm start"
healthcheckPath = "/health"
healthcheckTimeout = 30

[[services]]
name = "frontend"
buildCommand = "cd frontend && npm install && npm run build"
startCommand = "cd frontend && npm start"

[[services]]
name = "redis"
image = "redis:7-alpine"
volumes = ["/data"]

[[services]]
name = "postgres"
image = "postgres:16-alpine"
volumes = ["/var/lib/postgresql/data"]
environment = ["POSTGRES_DB=24hrmvp"]
